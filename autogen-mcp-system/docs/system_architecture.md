â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”
â”‚                     LAYER 1: USER INTERFACE                    â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”   â”‚
â”‚  â”‚          OpenWebUI (Web-based Chat Interface)           â”‚   â”‚
â”‚  â”‚              â€¢ LDAP Authentication                      â”‚   â”‚
â”‚  â”‚              â€¢ Natural Language Input                   â”‚   â”‚
â”‚  â”‚              â€¢ Real-time Agent Responses                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                                        â”‚
                      â”‚                                          â”‚
                      â–¼                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LAYER 2: ORCHESTRATION LAYER                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”   â”‚
â”‚  â”‚           SUPERVISOR / ROUTER AGENT                     â”‚   â”‚
â”‚  â”‚           (Powered by Ollama + Gemma)                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Analyzes user intent and classifies as:                â”‚   â”‚
â”‚  â”‚    â€¢ DATA_ANALYSIS    â†’ Data Team                       â”‚   â”‚
â”‚  â”‚    â€¢ WEB_RESEARCH     â†’ Research Team                   â”‚   â”‚
â”‚  â”‚    â€¢ CALENDAR         â†’ Calendar Team                   â”‚   â”‚
â”‚  â”‚    â€¢ MIXED            â†’ Multiple Teams                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”˜   â”‚
â”‚                      â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚         â–¼            â–¼            â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   DATA   â”‚  â”‚   WEB    â”‚  â”‚ CALENDAR â”‚                      â”‚
â”‚  â”‚ ANALYSIS â”‚  â”‚ RESEARCH â”‚  â”‚   MGMT   â”‚                      â”‚
â”‚  â”‚   TEAM   â”‚  â”‚   TEAM   â”‚  â”‚   TEAM   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€--â”€â”˜
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LAYER 3: AGENT TEAMS                         â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DATA ANALYSIS TEAM (Magentic)              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  SQL Agent  â”‚  â”‚ Analysis Agent â”‚  â”‚  Validation  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚                â”‚  â”‚    Agent     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Generates   â”‚  â”‚ Performs data  â”‚  â”‚ Reviews and  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ SQL queries â”‚â†’ â”‚ analysis with  â”‚â†’ â”‚ validates    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Executes    â”‚  â”‚ pandas/stats   â”‚  â”‚ all findings â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ via tools   â”‚  â”‚                â”‚  â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              WEB RESEARCH TEAM (Magentic)               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚Search Agent â”‚  â”‚  Summarizer    â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚     Agent      â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ Queries web â”‚â†’ â”‚  Condenses     â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ APIs for    â”‚  â”‚  findings &    â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ information â”‚  â”‚  creates       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚  summaries     â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            CALENDAR MANAGEMENT TEAM (Magentic)          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ Scheduler   â”‚  â”‚ Conflict       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚   Agent     â”‚  â”‚  Checker       â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚   Agent        â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ Books mtgs  â”‚â†’ â”‚ Detects        â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ Manages     â”‚  â”‚ scheduling     â”‚                    â”‚   â”‚
â”‚  â”‚  â”‚ calendar    â”‚  â”‚ conflicts      â”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”
â”‚                    LAYER 4: MCP SERVER                         â”‚
â”‚                    (FastAPI Application)                       â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”   â”‚
â”‚  â”‚                    EXPOSED TOOLS                        â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  1. sql_tool(query_description, sql_script)             â”‚   â”‚
â”‚  â”‚     â†’ Executes SQL with retry logic                     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  2. data_analysis_tool(data_json, analysis_type)        â”‚   â”‚
â”‚  â”‚     â†’ Performs pandas analysis                          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  3. get_table_schema(table_name)                        â”‚   â”‚
â”‚  â”‚     â†’ Returns table structure                           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  Future:                                                â”‚   â”‚
â”‚  â”‚  4. web_search_tool(query, max_results)                 â”‚   â”‚
â”‚  â”‚  5. calendar_tool(action, params)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”   â”‚
â”‚  â”‚              SUPPORTING COMPONENTS                      â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â€¢ LDAP Authentication (verify_credentials)             â”‚   â”‚
â”‚  â”‚  â€¢ Query Retry Handler (3 attempts, exponential)        â”‚   â”‚
â”‚  â”‚  â€¢ SQL Query Validation (blocks dangerous ops)          â”‚   â”‚
â”‚  â”‚  â€¢ Structured Logging (Loguru)                          â”‚   â”‚
â”‚  â”‚  â€¢ Health Checks (/health, /health/db)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LAYER 5: DATA & SERVICES                      â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  MS SQL      â”‚  â”‚   Ollama     â”‚  â”‚    LDAP      â”‚          â”‚
â”‚  â”‚  Server      â”‚  â”‚   + Gemma    â”‚  â”‚   / AD       â”‚          â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚
â”‚  â”‚ â€¢ 100GB+     â”‚  â”‚ â€¢ Local LLM  â”‚  â”‚ â€¢ Enterprise â”‚          â”‚
â”‚  â”‚ â€¢ 50-60      â”‚  â”‚ â€¢ No API     â”‚  â”‚   Auth       â”‚          â”‚
â”‚  â”‚   tables     â”‚  â”‚   keys       â”‚  â”‚ â€¢ User       â”‚          â”‚
â”‚  â”‚ â€¢ Millions   â”‚  â”‚ â€¢ Private    â”‚  â”‚   groups     â”‚          â”‚
â”‚  â”‚   of rows    â”‚  â”‚   data       â”‚  â”‚              â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## ğŸ”„ DATA FLOW - How a User Request Works

### Example: "Show Q4 2024 sales by region and calculate growth trends"
```

STEP 1: USER INPUT
â”œâ”€ User types in OpenWebUI: "Show Q4 2024 sales by region and calculate growth trends"
â”œâ”€ OpenWebUI authenticates via LDAP (username: john.doe)
â””â”€ Request sent to MCP Server API

STEP 2: SUPERVISOR ROUTING
â”œâ”€ Supervisor Agent receives request
â”œâ”€ Analyzes intent using Ollama + Gemma
â”œâ”€ Classification: "DATA_ANALYSIS" (SQL + statistics needed)
â”œâ”€ Context prepared for Data Analysis Team
â””â”€ Routes to Data Analysis Team

STEP 3: DATA ANALYSIS TEAM COLLABORATES (Magentic Pattern)
â”‚
â”œâ”€ SQL Agent (Turn 1):
â”‚   â”œâ”€ "I need to understand the sales table structure"
â”‚   â”œâ”€ Calls: get_table_schema("sales")
â”‚   â”œâ”€ Receives: columns [region, date, amount, product_id]
â”‚   â””â”€ Generates SQL:
â”‚       "SELECT region,
â”‚               SUM(amount) as total_sales,
â”‚               COUNT(*) as transaction_count
â”‚        FROM sales
â”‚        WHERE date >= '2024-10-01' AND date <= '2024-12-31'
â”‚        GROUP BY region
â”‚        ORDER BY total_sales DESC"
â”‚
â”œâ”€ SQL Agent (Turn 2):
â”‚   â”œâ”€ Calls: sql_tool("Q4 sales by region", [SQL above])
â”‚   â”œâ”€ MCP Server validates SQL (passes - no dangerous keywords)
â”‚   â”œâ”€ Retry Handler: Attempt 1
â”‚   â”œâ”€ SQL executes successfully
â”‚   â””â”€ Returns:
â”‚       {
â”‚         "success": true,
â”‚         "columns": ["region", "total_sales", "transaction_count"],
â”‚         "rows": [
â”‚           {"region": "North", "total_sales": 1500000, "transaction_count": 3200},
â”‚           {"region": "South", "total_sales": 1200000, "transaction_count": 2800},
â”‚           {"region": "East", "total_sales": 980000, "transaction_count": 2100},
â”‚           {"region": "West", "total_sales": 750000, "transaction_count": 1600}
â”‚         ],
â”‚         "row_count": 4
â”‚       }
â”‚
â”œâ”€ Analysis Agent (Turn 3):
â”‚   â”œâ”€ Receives SQL results from SQL Agent
â”‚   â”œâ”€ "I'll calculate growth trends by comparing to Q3"
â”‚   â”œâ”€ Requests Q3 data (asks SQL Agent)
â”‚   â””â”€ SQL Agent fetches Q3 data
â”‚
â”œâ”€ SQL Agent (Turn 4):
â”‚   â”œâ”€ Generates Q3 query
â”‚   â”œâ”€ Executes via sql_tool
â”‚   â””â”€ Returns Q3 data
â”‚
â”œâ”€ Analysis Agent (Turn 5):
â”‚   â”œâ”€ Now has Q4 and Q3 data
â”‚   â”œâ”€ Calls: data_analysis_tool(combined_json, "trend")
â”‚   â”œâ”€ Calculates:
â”‚   â”‚   â€¢ North: +12.5% growth
â”‚   â”‚   â€¢ South: +8.3% growth
â”‚   â”‚   â€¢ East: -3.2% decline
â”‚   â”‚   â€¢ West: +15.7% growth
â”‚   â”œâ”€ Identifies insights:
â”‚   â”‚   â€¢ Overall growth: +9.8%
â”‚   â”‚   â€¢ West region shows strongest growth
â”‚   â”‚   â€¢ East region declining, needs attention
â”‚   â””â”€ Prepares summary
â”‚
â””â”€ Validation Agent (Turn 6):
    â”œâ”€ Reviews SQL queries: âœ“ Syntactically correct
    â”œâ”€ Reviews calculations: âœ“ Math checks out
    â”œâ”€ Reviews logic: âœ“ Q3 vs Q4 comparison makes sense
    â”œâ”€ Reviews insights: âœ“ Conclusions supported by data
    â”œâ”€ Checks for data quality issues: âœ“ No nulls, no anomalies
    â””â”€ APPROVES final response

STEP 4: RESPONSE AGGREGATION
â”œâ”€ Team conversation complete (6 turns, under max 15)
â”œâ”€ Final result compiled
â””â”€ Formatted for user

STEP 5: DELIVERY TO USER
â”œâ”€ Response returned to OpenWebUI
â””â”€ User sees:

    "Q4 2024 Sales Analysis by Region:
    
    Regional Performance:
    â€¢ North: $1,500,000 (3,200 transactions) - â†‘ 12.5% vs Q3
    â€¢ South: $1,200,000 (2,800 transactions) - â†‘ 8.3% vs Q3
    â€¢ East: $980,000 (2,100 transactions) - â†“ 3.2% vs Q3
    â€¢ West: $750,000 (1,600 transactions) - â†‘ 15.7% vs Q3
    
    Key Insights:
    1. Overall Q4 growth: +9.8% compared to Q3
    2. West region shows strongest growth momentum
    3. East region experiencing decline - recommend investigation
    4. North region maintains largest market share
    
    Total Q4 Sales: $4,430,000 across 9,700 transactions"

```

---

## ğŸ› ï¸ TECHNICAL COMPONENTS BREAKDOWN

### 1. **MCP Server** (FastAPI)
**Location**: `mcp_server/` directory
**Purpose**: Exposes Python functions as tools to AI agents

**Key Files**:
- `main.py` - FastAPI app, routes, MCP tool registration
- `database.py` - MS SQL connection, query execution, retry logic
- `tools.py` - Tool definitions (sql_tool, data_analysis_tool, etc.)
- `auth.py` - LDAP authentication middleware

**What it does**:
- Authenticates users via LDAP
- Validates SQL queries (blocks DROP, DELETE, etc.)
- Executes queries with automatic retry (3 attempts, exponential backoff)
- Provides health check endpoints
- Logs all operations with structured logging

### 2. **Agent Orchestrator** (AutoGen 2)
**Location**: `agents/` directory
**Purpose**: Coordinates multiple AI agent teams

**Key Components**:
- **Supervisor/Router Agent**: Classifies user intent, routes to appropriate team
- **Team Manager**: Loads team configurations from JSON
- **Conversation Manager**: Handles multi-turn agent conversations
- **Result Aggregator**: Combines outputs from multiple teams

**Agent Collaboration Pattern**: Magentic
- Agents talk to each other as needed
- Not strictly sequential
- Validation agent can request corrections
- Max 15 turns to prevent infinite loops

### 3. **Data Analysis Team**
**Members**: 3 agents
- **SQL Agent**: Generates and executes SQL queries
- **Analysis Agent**: Performs statistical analysis with pandas
- **Validation Agent**: Reviews and validates findings

**Tools Available**:
- `sql_tool` - Execute SQL with retry
- `data_analysis_tool` - Pandas analysis
- `get_table_schema` - Understand table structure

### 4. **Web Research Team** (Future)
**Members**: 2 agents
- **Search Agent**: Queries web APIs
- **Summarizer Agent**: Condenses findings

**Tools Needed** (to be implemented):
- `web_search_tool` - Internet search
- `content_scraper_tool` - Extract content

### 5. **Calendar Management Team** (Future)
**Members**: 2 agents
- **Scheduler Agent**: Books meetings
- **Conflict Checker Agent**: Detects conflicts

**Tools Needed** (to be implemented):
- `calendar_tool` - Create/update events
- `availability_tool` - Check free/busy

### 6. **Configuration Layer**
**Location**: `config/` directory

**Key Files**:
- `settings.py` - Environment variables, Pydantic models
- `ldap_config.py` - LDAP authentication logic

**Environment Variables** (`.env`):
```

# Ollama

OLLAMA_HOST=<http://localhost:11434>
OLLAMA_MODEL=gemma

# MS SQL Server

MSSQL_SERVER=your_server
MSSQL_DATABASE=your_database
MSSQL_USER=your_user
MSSQL_PASSWORD=your_password

# LDAP

LDAP_SERVER=ldap://your_ad_server
LDAP_BASE_DN=dc=company,dc=com
LDAP_SERVICE_ACCOUNT_USER=<service@company.com>
LDAP_SERVICE_ACCOUNT_PASSWORD=password

# Agent Config

AGENT_RETRY_ATTEMPTS=3
AGENT_ESCALATION_EMAIL=<team-lead@company.com>

```

### 7. **Utilities**
**Location**: `utils/` directory

**Key Components**:
- `logging_config.py` - Structured logging setup (Loguru)
- `retry_handler.py` - Query retry logic with exponential backoff

**Retry Logic**:
```

Attempt 1: Execute immediately
  â†“ (fails)
Wait 2 seconds
  â†“
Attempt 2: Execute again
  â†“ (fails)
Wait 4 seconds
  â†“
Attempt 3: Execute final time
  â†“ (fails)
Escalate to human (send email to AGENT_ESCALATION_EMAIL)

```

### 8. **Testing Suite**
**Location**: `tests/` directory

**Test Coverage**:
- Database connection tests
- LDAP authentication tests
- Query validation tests
- Retry handler tests
- MCP tool tests
- Integration tests
- API endpoint tests

**Run with**: `pytest tests/ -v`

### 9. **AutoGen Studio** (Visual Design Tool)
**Purpose**: Drag-and-drop agent design without code

**Workflow**:
1. Design agent teams visually
2. Configure system messages, tools, models
3. Test in Playground
4. Export as JSON
5. Commit JSON to Git
6. Load JSON in production Python code

**Installation**: `pip install autogen-studio`
**Launch**: `autogen-studio ui`
**Access**: http://127.0.0.1:8081

### 10. **Documentation**
**Location**: `docs/` directory

**9 Professional Templates**:
- README.md - Navigation
- QUICK_START.md - 30-minute setup
- ARCHITECTURE.md - System design (this document!)
- AUTOGEN_STUDIO_GUIDE.md - Visual editing guide
- MCP_SERVER.md - Tool documentation
- AGENTS.md - Team structure
- FAQ.md - Troubleshooting
- GLOSSARY.md - Domain terms
- TESTING.md - Test strategies

---

## ğŸ“Š TECHNOLOGY STACK

### Programming & Frameworks
| Component | Technology | Version | Purpose |
|-----------|-----------|---------|---------|
| Language | Python | 3.10+ | Primary development |
| API Framework | FastAPI | 0.104+ | MCP server |
| Agent Framework | AutoGen 2 | 0.4.8+ | Multi-agent orchestration |
| MCP Protocol | FastMCP | 0.1.0+ | Tool exposure |
| Testing | pytest | Latest | Unit & integration tests |

### AI & LLM
| Component | Technology | Version | Purpose |
|-----------|-----------|---------|---------|
| LLM Runtime | Ollama | Latest | Local inference |
| Model | Gemma | 2B/7B | Language model |
| Studio | AutoGen Studio | Latest | Visual agent design |

### Database & Data
| Component | Technology | Version | Purpose |
|-----------|-----------|---------|---------|
| Database | MS SQL Server | 2016+ | Data warehouse |
| ODBC Driver | Microsoft ODBC 17+ | Latest | Database connectivity |
| ORM | SQLAlchemy | 2.0+ | Query building |
| Data Analysis | pandas | 2.1+ | Statistical analysis |
| Database Client | pyodbc | 5.1+ | SQL Server connection |

### Authentication & Security
| Component | Technology | Version | Purpose |
|-----------|-----------|---------|---------|
| Auth Protocol | LDAP | - | User authentication |
| LDAP Client | ldap3 | 1.4+ | Python LDAP interface |
| Secrets | python-dotenv | 1.0+ | Environment variables |

### Utilities
| Component | Technology | Version | Purpose |
|-----------|-----------|---------|---------|
| Logging | Loguru | 0.7+ | Structured logging |
| Retry Logic | tenacity | 8.2+ | Exponential backoff |
| Config | Pydantic | 2.5+ | Settings validation |

---

## ğŸ“ PROJECT STRUCTURE
```

autogen-mcp-system/
â”‚
â”œâ”€â”€ config/                      # Configuration layer
â”‚   â”œâ”€â”€ settings.py             # Environment settings (Pydantic)
â”‚   â””â”€â”€ ldap_config.py          # LDAP authentication
â”‚
â”œâ”€â”€ mcp_server/                  # MCP Server (FastAPI)
â”‚   â”œâ”€â”€ main.py                 # FastAPI app + routes
â”‚   â”œâ”€â”€ database.py             # MS SQL connections
â”‚   â”œâ”€â”€ auth.py                 # LDAP middleware
â”‚   â””â”€â”€ tools.py                # MCP tool definitions
â”‚
â”œâ”€â”€ agents/                      # Agent orchestration
â”‚   â””â”€â”€ orchestrator.py         # Supervisor + team management
â”‚
â”œâ”€â”€ utils/                       # Shared utilities
â”‚   â”œâ”€â”€ logging_config.py       # Loguru setup
â”‚   â””â”€â”€ retry_handler.py        # Query retry logic
â”‚
â”œâ”€â”€ tests/                       # Test suite
â”‚   â”œâ”€â”€ test_database.py        # DB tests
â”‚   â”œâ”€â”€ test_ldap.py            # Auth tests
â”‚   â”œâ”€â”€ test_retry_handler.py   # Retry tests
â”‚   â””â”€â”€ test_mcp_tools.py       # Tool tests
â”‚
â”œâ”€â”€ autogen_configs/             # Studio JSON exports
â”‚   â”œâ”€â”€ data_analysis_team.json
â”‚   â”œâ”€â”€ web_research_team.json
â”‚   â””â”€â”€ calendar_team.json
â”‚
â”œâ”€â”€ docs/                        # Documentation
â”‚   â”œâ”€â”€ README.md               # Start here
â”‚   â”œâ”€â”€ QUICK_START.md          # Setup guide
â”‚   â”œâ”€â”€ ARCHITECTURE.md         # This document
â”‚   â”œâ”€â”€ AUTOGEN_STUDIO_GUIDE.md # Visual editing
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ MCP_SERVER.md       # Tool docs
â”‚   â”‚   â””â”€â”€ AGENTS.md           # Team docs
â”‚   â”œâ”€â”€ FAQ.md                  # Troubleshooting
â”‚   â”œâ”€â”€ GLOSSARY.md             # Terms
â”‚   â””â”€â”€ TESTING.md              # Test guide
â”‚
â”œâ”€â”€ logs/                        # Runtime logs
â”‚   â””â”€â”€ app.log                 # (auto-created)
â”‚
â”œâ”€â”€ .env                         # Credentials (NOT in Git)
â”œâ”€â”€ .env.example                 # Template
â”œâ”€â”€ .gitignore                   # Git exclusions
â”œâ”€â”€ requirements.txt             # Python dependencies
â”‚
â”œâ”€â”€ run_mcp_server.py            # Start MCP server
â”œâ”€â”€ run_agents.py                # Start agents (POC)
â”œâ”€â”€ run_agents_api.py            # Start agents (HTTP API)
â”‚
â”œâ”€â”€ test_mssql_connection.py     # Manual DB test
â”œâ”€â”€ test_ldap_connection.py      # Manual LDAP test
â””â”€â”€ manual_integration_tests.py  # Full system test
